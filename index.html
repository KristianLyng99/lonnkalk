<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monthly Earnings Calculator</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background-color: #f8f9fa;
      padding: 20px;
      color: #333;
    }
    
    .container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      width: 100%;
      padding: 24px;
      margin: 0 auto;
    }
    
    h1 {
      color: #0e766e;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .total-section {
      background-color: #e6fffa;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-bottom: 24px;
    }
    
    .total-amount {
      font-size: 36px;
      font-weight: bold;
      color: #0e766e;
      margin-bottom: 5px;
    }
    
    .info-text {
      color: #718096;
      font-size: 14px;
      margin-bottom: 5px;
    }
    
    .shift-form {
      background-color: #f7fafc;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .form-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: #0e766e;
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .form-group {
      flex: 1;
      min-width: 120px;
    }
    
    .form-group label {
      display: block;
      font-size: 13px;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .btn {
      display: inline-block;
      background-color: #0e766e;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .btn:hover {
      background-color: #0c6259;
    }
    
    .btn-red {
      background-color: #e53e3e;
    }
    
    .btn-red:hover {
      background-color: #c53030;
    }
    
    .btn-full {
      width: 100%;
    }
    
    .shifts-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 14px;
    }
    
    .shifts-table th,
    .shifts-table td {
      border: 1px solid #e2e8f0;
      padding: 10px;
      text-align: left;
    }
    
    .shifts-table th {
      background-color: #f7fafc;
      font-weight: 600;
    }
    
    .shifts-table tr:nth-child(even) {
      background-color: #f7fafc;
    }
    
    .text-center {
      text-align: center;
    }
    
    .no-shifts {
      text-align: center;
      padding: 20px;
      color: #718096;
      font-style: italic;
    }
    
    .action-column {
      width: 80px;
      text-align: center;
    }
    
    .clear-all {
      color: #e53e3e;
      text-decoration: underline;
      background: none;
      border: none;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .clear-all:hover {
      color: #c53030;
    }
    
    .break-container {
      display: flex;
      align-items: center;
    }
    
    .break-checkbox {
      margin-right: 10px;
      width: auto;
    }
    
    @media (max-width: 600px) {
      .form-group {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Monthly Earnings Calculator</h1>
    
    <div class="total-section">
      <div class="info-text">Total monthly earnings:</div>
      <div class="total-amount" id="totalAmount">0.00 kr</div>
      <div class="info-text">Base hourly rate: 284.49 kr</div>
      <div class="info-text" id="totalHours">Total hours: 0</div>
    </div>
    
    <div class="shift-form">
      <div class="form-title">Add Work Shift</div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="shiftDate">Date:</label>
          <input type="date" id="shiftDate" required>
        </div>
        
        <div class="form-group">
          <label for="shiftType">Day Type:</label>
          <select id="shiftType">
            <option value="auto">Auto-detect from date</option>
            <option value="weekday">Mon-Thu</option>
            <option value="friday">Friday</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
            <option value="holiday">Holiday</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="startTime">Start Time:</label>
          <input type="time" id="startTime" value="09:00" required>
        </div>
        
        <div class="form-group">
          <label for="endTime">End Time:</label>
          <input type="time" id="endTime" value="17:00" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="breakCheck">Include 30-min meal break?</label>
          <div class="break-container">
            <input type="checkbox" id="breakCheck" class="break-checkbox">
            <input type="time" id="breakTime" value="12:00">
          </div>
        </div>
      </div>
      
      <button class="btn btn-full" id="addShiftBtn">Add Shift</button>
    </div>
    
    <div id="shiftsTableContainer">
      <div class="no-shifts">No shifts added yet. Start by adding shifts above.</div>
    </div>
    
    <div class="text-center">
      <button class="clear-all" id="clearAllBtn">Clear All Shifts</button>
    </div>
  </div>

  <script>
    (function() {
      // Constants
      const BASE_RATE = 284.49;
      
      // DOM Elements
      const totalAmountEl = document.getElementById('totalAmount');
      const totalHoursEl = document.getElementById('totalHours');
      const dateInput = document.getElementById('shiftDate');
      const typeSelect = document.getElementById('shiftType');
      const startTimeInput = document.getElementById('startTime');
      const endTimeInput = document.getElementById('endTime');
      const breakCheckbox = document.getElementById('breakCheck');
      const breakTimeInput = document.getElementById('breakTime');
      const addShiftBtn = document.getElementById('addShiftBtn');
      const clearAllBtn = document.getElementById('clearAllBtn');
      const tableContainer = document.getElementById('shiftsTableContainer');
      
      // Set today's date as default
      dateInput.value = new Date().toISOString().split('T')[0];
      
      // Store shifts
      let shifts = [];
      
      // Load shifts from localStorage if available
      if (localStorage.getItem('monthlyShifts')) {
        try {
          const savedShifts = JSON.parse(localStorage.getItem('monthlyShifts'));
          if (Array.isArray(savedShifts)) {
            shifts = savedShifts.map(shift => ({
              ...shift,
              date: new Date(shift.date)
            }));
            updateShiftsTable();
            updateTotals();
          }
        } catch (e) {
          console.error("Error loading saved shifts:", e);
        }
      }
      
      // Compensation rates based on day type and time
      const compensationRates = {
        'weekday': [
          { range: '06:00-08:00', rate: 1.25 },
          { range: '08:00-16:00', rate: 1.00 },
          { range: '16:00-18:00', rate: 1.25 },
          { range: '18:00-21:00', rate: 1.30 },
          { range: '21:00-06:00', rate: 2.00 },
          { range: 'default', rate: 1.00 }
        ],
        'friday': [
          { range: '06:00-08:00', rate: 1.25 },
          { range: '08:00-16:00', rate: 1.00 },
          { range: '16:00-21:00', rate: 1.50 },
          { range: '21:00-06:00', rate: 2.00 },
          { range: 'default', rate: 1.00 }
        ],
        'saturday': [
          { range: '00:00-06:00', rate: 2.00 },
          { range: '06:00-15:30', rate: 2.00 },
          { range: '15:30-24:00', rate: 2.20 },
          { range: 'default', rate: 2.00 }
        ],
        'sunday': [
          { range: '00:00-24:00', rate: 2.20 },
          { range: 'default', rate: 2.20 }
        ],
        'holiday': [
          { range: '00:00-24:00', rate: 2.50 },
          { range: 'default', rate: 2.50 }
        ]
      };
      
      // Norwegian holidays (simplified)
      const holidays = [
        { month: 0, day: 1 },    // Jan 1 - New Year
        { month: 4, day: 1 },    // May 1 - Labor Day
        { month: 4, day: 17 },   // May 17 - Constitution Day
        { month: 11, day: 25 },  // Dec 25 - Christmas
        { month: 11, day: 26 }   // Dec 26 - Boxing Day
      ];
      
      // Helper: Check if date is a holiday
      function isHoliday(date) {
        const month = date.getMonth();
        const day = date.getDate();
        
        return holidays.some(h => h.month === month && h.day === day);
      }
      
      // Helper: Determine day type from date
      function getDayTypeFromDate(date) {
        if (isHoliday(date)) return 'holiday';
        
        const day = date.getDay();
        if (day === 0) return 'sunday';
        if (day === 6) return 'saturday';
        if (day === 5) return 'friday';
        return 'weekday';
      }
      
      // Helper: Convert time string to minutes
      function timeToMinutes(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
      }
      
      // Helper: Check if time is in range
      function isTimeInRange(time, start, end) {
        const timeMin = timeToMinutes(time);
        const startMin = timeToMinutes(start);
        let endMin = timeToMinutes(end);
        
        // Handle overnight ranges
        if (endMin < startMin) {
          endMin += 24 * 60;
          
          const timeHours = parseInt(time.split(':')[0]);
          let adjustedTimeMin = timeMin;
          
          if (timeHours < 12 && startMin > 12 * 60) {
            adjustedTimeMin += 24 * 60;
          }
          
          return adjustedTimeMin >= startMin || timeMin <= endMin;
        }
        
        return timeMin >= startMin && timeMin <= endMin;
      }
      
      // Format date for display
      function formatDate(date) {
        return date.toLocaleDateString(undefined, {
          weekday: 'short',
          month: 'short',
          day: 'numeric'
        });
      }
      
      // Calculate earnings for a shift
      function calculateShiftEarnings(date, dayType, startTime, endTime, includeBreak, breakTime) {
        // Calculate duration
        let startMinutes = timeToMinutes(startTime);
        let endMinutes = timeToMinutes(endTime);
        
        // Handle overnight shifts
        if (endMinutes < startMinutes) {
          endMinutes += 24 * 60;
        }
        
        // Get rates for this day type
        const rates = compensationRates[dayType];
        
        // Handle meal break
        if (includeBreak && breakTime) {
          // Get break time in minutes
          let breakStartMinutes = timeToMinutes(breakTime);
          
          // For overnight shifts, adjust break time if needed
          if (startMinutes > endMinutes && breakStartMinutes < startMinutes) {
            breakStartMinutes += 24 * 60;
          }
          
          // Make sure break is within shift hours
          if (breakStartMinutes >= startMinutes && breakStartMinutes + 30 <= endMinutes) {
            // Break is within shift time
            // We'll calculate earnings in two parts: before break and after break
            
            const breakEndMinutes = breakStartMinutes + 30; // 30 minute break
            
            // Calculate first part (start to break)
            const firstPartEarnings = calculatePartialShiftEarnings(
              dayType, 
              rates,
              startMinutes, 
              breakStartMinutes
            );
            
            // Calculate second part (after break to end)
            const secondPartEarnings = calculatePartialShiftEarnings(
              dayType,
              rates,
              breakEndMinutes,
              endMinutes
            );
            
            // Combine results
            return {
              duration: (breakStartMinutes - startMinutes + endMinutes - breakEndMinutes) / 60,
              earnings: firstPartEarnings.earnings + secondPartEarnings.earnings,
              segments: [...firstPartEarnings.segments, ...secondPartEarnings.segments]
            };
          }
        }
        
        // No break or break outside shift hours - calculate normally
        return calculatePartialShiftEarnings(dayType, rates, startMinutes, endMinutes);
      }
      
      // Calculate earnings for part of a shift (either whole shift or part before/after break)
      function calculatePartialShiftEarnings(dayType, rates, startMinutes, endMinutes) {
        const durationHours = (endMinutes - startMinutes) / 60;
        
        // Track total earnings and segments
        let totalEarnings = 0;
        let segments = [];
        let currentMinutes = startMinutes;
        let hoursRemaining = durationHours;
        
        while (hoursRemaining > 0) {
          // Format current time
          const currentHour = Math.floor((currentMinutes % (24 * 60)) / 60);
          const currentMin = currentMinutes % 60;
          const currentTime = `${currentHour.toString().padStart(2, '0')}:${currentMin.toString().padStart(2, '0')}`;
          
          // Find applicable rate
          let rate = 1.0;
          let rateDesc = 'Regular';
          
          for (const period of rates) {
            if (period.range === 'default') continue;
            
            const [start, end] = period.range.split('-');
            
            if (isTimeInRange(currentTime, start, end)) {
              rate = period.rate;
              rateDesc = period.range;
              break;
            }
          }
          
          // Determine segment duration
          let hoursInSegment = 0;
          
          // Fixed rate for entire day
          if (rates.length === 2 && rates[0].range === '00:00-24:00') {
            hoursInSegment = hoursRemaining;
          } else {
            // Find next rate change
            let nextChangeMinutes = 24 * 60;
            
            for (const period of rates) {
              if (period.range === 'default') continue;
              
              const [start, _] = period.range.split('-');
              const startMin = timeToMinutes(start);
              
              // Next rate change after current time
              if ((startMin > currentMinutes % (24 * 60)) && 
                  (startMin < nextChangeMinutes)) {
                nextChangeMinutes = startMin;
              }
            }
            
            // If no next change found in the day, go to midnight
            if (nextChangeMinutes === 24 * 60) {
              nextChangeMinutes = 24 * 60;
            }
            
            // Calculate hours until change
            const minutesUntilChange = 
              nextChangeMinutes > (currentMinutes % (24 * 60)) 
                ? nextChangeMinutes - (currentMinutes % (24 * 60))
                : (24 * 60 + nextChangeMinutes) - (currentMinutes % (24 * 60));
            
            const hoursUntilChange = minutesUntilChange / 60;
            
            // Use smaller of hours until change, remaining hours, or time to end
            const hoursToEnd = (endMinutes - currentMinutes) / 60;
            hoursInSegment = Math.min(hoursUntilChange, hoursRemaining, hoursToEnd);
          }
          
          // Calculate earnings for segment
          const segmentEarnings = hoursInSegment * BASE_RATE * rate;
          totalEarnings += segmentEarnings;
          
          // Save segment
          segments.push({
            time: currentTime,
            hours: hoursInSegment,
            rate: rate,
            earnings: segmentEarnings
          });
          
          // Advance time and reduce remaining hours
          currentMinutes += hoursInSegment * 60;
          hoursRemaining -= hoursInSegment;
        }
        
        return {
          duration: durationHours,
          earnings: totalEarnings,
          segments: segments
        };
      }
      
      // Add a shift
      function addShift() {
        const dateStr = dateInput.value;
        if (!dateStr) {
          alert('Please select a date');
          return;
        }
        
        const date = new Date(dateStr);
        let dayType = typeSelect.value;
        
        // Auto-detect day type if needed
        if (dayType === 'auto') {
          dayType = getDayTypeFromDate(date);
        }
        
        const startTime = startTimeInput.value;
        const endTime = endTimeInput.value;
        
        if (!startTime || !endTime) {
          alert('Please enter start and end times');
          return;
        }
        
        // Get break info
        const includeBreak = breakCheckbox.checked;
        const breakTime = breakTimeInput.value;
        
        // Validate break time is within shift
        if (includeBreak) {
          const breakMinutes = timeToMinutes(breakTime);
          let startMinutes = timeToMinutes(startTime);
          let endMinutes = timeToMinutes(endTime);
          
          // Adjust for overnight shifts
          if (endMinutes < startMinutes) {
            endMinutes += 24 * 60;
          }
          
          // Check if break starts within shift
          let breakInShift = false;
          
          if (breakMinutes >= startMinutes && breakMinutes + 30 <= endMinutes) {
            breakInShift = true;
          } else if (breakMinutes < startMinutes && breakMinutes + 24 * 60 >= startMinutes && (breakMinutes + 24 * 60) + 30 <= endMinutes) {
            // Overnight shift with break on next day
            breakInShift = true;
          }
          
          if (!breakInShift) {
            if (!confirm("The break time appears to be outside your shift or too close to the end. Continue anyway?")) {
              return;
            }
          }
        }
        
        // Calculate earnings
        const result = calculateShiftEarnings(date, dayType, startTime, endTime, includeBreak, breakTime);
        
        // Create shift object
        const shift = {
          id: Date.now(), // Unique ID
          date: date,
          dayType: dayType,
          startTime: startTime,
          endTime: endTime,
          includeBreak: includeBreak,
          breakTime: breakTime,
          duration: result.duration,
          earnings: result.earnings,
          segments: result.segments
        };
        
        // Add to array
        shifts.push(shift);
        
        // Save to localStorage
        saveShifts();
        
        // Update UI
        updateShiftsTable();
        updateTotals();
      }
      
      // Delete a shift
      function deleteShift(id) {
        shifts = shifts.filter(shift => shift.id !== id);
        saveShifts();
        updateShiftsTable();
        updateTotals();
      }
      
      // Clear all shifts
      function clearAllShifts() {
        if (confirm('Are you sure you want to clear all shifts?')) {
          shifts = [];
          saveShifts();
          updateShiftsTable();
          updateTotals();
        }
      }
      
      // Save shifts to localStorage
      function saveShifts() {
        localStorage.setItem('monthlyShifts', JSON.stringify(shifts));
      }
      
      // Update the shifts table
      function updateShiftsTable() {
        if (shifts.length === 0) {
          tableContainer.innerHTML = '<div class="no-shifts">No shifts added yet. Start by adding shifts above.</div>';
          return;
        }
        
        // Sort shifts by date
        const sortedShifts = [...shifts].sort((a, b) => a.date - b.date);
        
        let html = `
          <table class="shifts-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Times</th>
                <th>Hours</th>
                <th>Earnings</th>
                <th class="action-column">Action</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        sortedShifts.forEach(shift => {
          const dayName = shift.dayType.charAt(0).toUpperCase() + shift.dayType.slice(1);
          html += `
            <tr>
              <td>${formatDate(shift.date)} <span style="color:#718096">(${dayName})</span></td>
              <td>${shift.startTime} - ${shift.endTime} ${shift.includeBreak ? `<span style="color:#718096">(break: ${shift.breakTime})</span>` : ''}</td>
              <td>${shift.duration.toFixed(2)}</td>
              <td>${shift.earnings.toFixed(2)} kr</td>
              <td class="text-center">
                <button class="btn btn-red" onclick="deleteShift(${shift.id})">×</button>
              </td>
            </tr>
          `;
        });
        
        html += `
            </tbody>
          </table>
        `;
        
        tableContainer.innerHTML = html;
      }
      
      // Update total amounts
      function updateTotals() {
        const totalEarnings = shifts.reduce((sum, shift) => sum + shift.earnings, 0);
        const totalHours = shifts.reduce((sum, shift) => sum + shift.duration, 0);
        
        totalAmountEl.textContent = `${totalEarnings.toFixed(2)} kr`;
        totalHoursEl.textContent = `Total hours: ${totalHours.toFixed(2)}`;
      }
      
      // Make deleteShift available globally
      window.deleteShift = deleteShift;
      
      // Add event listeners
      addShiftBtn.addEventListener('click', addShift);
      clearAllBtn.addEventListener('click', clearAllShifts);
    })();
  </script>
</body>
</html>
